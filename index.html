<!DOCTYPE html>
<html>
<head>
    <title>Transactions</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            position: fixed;
            top: 40px;
            left: 0;
            width: 100%;
            height: calc(100% - 40px);
            border: 1px solid #ccc;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #f2f2f2;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1;
        }

        .header-button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
        }

        .header-button:hover {
            background-color: #0056b3;
        }

        .lottery-address {
            font-weight: bold;
            margin-right: 10px;
        }

        .lottery-address-input {
            padding: 8px;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <button class="header-button" onclick="copyToClipboard()">Copy Address</button>
            <button class="header-button" onclick="openNanoWallet()">Open Wallet</button>
        </div>
        <div>
            <span class="lottery-address">Lottery Address:</span>
            <input class="lottery-address-input" type="text" id="lottery-address-input" value="nano_3y8c71a5ck8rpe5eeqdqym5gwieobs1u79hhh8nxfse719o651tgwj5ha9tc" readonly>
        </div>
    </div>

    <canvas id="transactionsCanvas"></canvas>

    <script>
        // Particle class
        class Particle {
            constructor(x, y, radius, image, address, sequenceNumber) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.image = image;
                this.address = address;
                this.sequenceNumber = sequenceNumber;
                this.velocity = {
                    x: (Math.random() - 0.5) * 4,
                    y: (Math.random() - 0.5) * 4
                };

                this.image.addEventListener('click', this.openInBrowser.bind(this));
            }

            draw(context) {
                context.drawImage(this.image, this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
                context.font = '12px Arial';
                context.fillStyle = '#ffffff';
                context.fillText(this.sequenceNumber, this.x - 6, this.y + 4);
            }

            update(canvas) {
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                    this.velocity.x *= -1;
                }

                if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                    this.velocity.y *= -1;
                }
            }

            openInBrowser() {
                const nanolookerUrl = `https://www.nanolooker.com/account/${this.address}`;
                window.open(nanolookerUrl, '_blank');
            }
        }

        // Make API request to fetch transactions
        const account = 'nano_3y8c71a5ck8rpe5eeqdqym5gwieobs1u79hhh8nxfse719o651tgwj5ha9tc';
        const apiUrl = `https://proxy.nanos.cc/proxy/?action=account_history&account=${account}&count=-1`;
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const transactions = data.history;
                const images = [];

                const canvas = document.getElementById('transactionsCanvas');
                const context = canvas.getContext('2d');

                const loadImagePromises = transactions.map((transaction, index) => {
                    const sender = transaction.account;
                    const natriconUrl = `https://natricon.com/api/v1/nano?address=${sender}`;
                    return new Promise((resolve, reject) => {
                        const image = new Image();
                        image.src = natriconUrl;
                        image.onload = () => {
                            images.push(new Particle(canvas.width / 2, canvas.height / 2, 30, image, sender, index + 1));
                            resolve();
                        };
                        image.onerror = reject;
                    });
                });

                Promise.all(loadImagePromises)
                    .then(() => {
                        // Set canvas dimensions
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight - 40;

                        function animate() {
                            requestAnimationFrame(animate);
                            context.clearRect(0, 0, canvas.width, canvas.height);

                            images.forEach(particle => {
                                particle.update(canvas);
                                particle.draw(context);
                            });
                        }

                        animate();
                    })
                    .catch(error => console.error(error));
            })
            .catch(error => console.error(error));

        function copyToClipboard() {
            const lotteryAddress = document.getElementById("lottery-address-input");
            lotteryAddress.select();
            lotteryAddress.setSelectionRange(0, 99999);
            document.execCommand("copy");
            alert("Address copied to clipboard!");
        }

        function openNanoWallet() {
            const lotteryAddress = document.getElementById("lottery-address-input").value;
            const walletURL = "nano:" + lotteryAddress;
            window.open(walletURL);
        }
    </script>
</body>
</html>
